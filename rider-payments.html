<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EasyGo - Payments</title>
    <link rel="stylesheet" href="assets/css/main.css">
    <link rel="stylesheet" href="assets/css/sidebar.css">
    <link rel="stylesheet" href="assets/css/responsive.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3f37c9;
            --success: #4cc9f0;
            --danger: #f72585;
            --warning: #f8961e;
            --info: #4895ef;
            --light: #f8f9fa;
            --dark: #212529;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f4f7fc;
            overflow-x: hidden;
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 20px;
        }

        .page-title h1 {
            font-size: 32px;
            color: var(--dark);
            margin-bottom: 5px;
        }

        .page-title p {
            color: #666;
            font-size: 14px;
        }

        .add-payment-btn {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
        }

        .add-payment-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(67, 97, 238, 0.3);
        }

        .wallet-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        }

        .wallet-info h3 {
            font-size: 16px;
            opacity: 0.9;
            margin-bottom: 10px;
        }

        .wallet-balance {
            font-size: 48px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .wallet-label {
            font-size: 14px;
            opacity: 0.8;
        }

        .wallet-actions {
            display: flex;
            gap: 15px;
        }

        .wallet-btn {
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 12px 30px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .wallet-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }

        .payment-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .summary-card {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .summary-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .summary-icon i {
            font-size: 24px;
            color: white;
        }

        .summary-info h3 {
            font-size: 14px;
            color: #666;
            margin-bottom: 5px;
        }

        .summary-info .number {
            font-size: 20px;
            font-weight: bold;
            color: var(--dark);
        }

        .payment-methods {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .section-header h2 {
            font-size: 20px;
            color: var(--dark);
        }

        .section-header button {
            background: none;
            border: none;
            color: var(--primary);
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .method-list {
            display: grid;
            gap: 15px;
        }

        .method-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            transition: all 0.3s;
            cursor: pointer;
        }

        .method-item:hover {
            border-color: var(--primary);
            transform: translateX(5px);
        }

        .method-item.default {
            border-color: var(--success);
            background: #f0f9ff;
        }

        .method-icon {
            width: 50px;
            height: 50px;
            background: #f0f0f0;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
        }

        .method-icon i {
            font-size: 24px;
            color: var(--primary);
        }

        .method-details {
            flex: 1;
        }

        .method-details h4 {
            color: var(--dark);
            margin-bottom: 5px;
        }

        .method-details p {
            color: #666;
            font-size: 14px;
        }

        .method-badge {
            background: var(--success);
            color: white;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            margin-left: 10px;
        }

        .method-actions {
            display: flex;
            gap: 10px;
        }

        .method-btn {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f8f9fa;
            color: #666;
            transition: all 0.3s;
            cursor: pointer;
            border: none;
        }

        .method-btn:hover {
            background: var(--primary);
            color: white;
        }

        .method-btn.delete:hover {
            background: var(--danger);
        }

        .transactions-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .transaction-filters {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .transaction-filter {
            padding: 8px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            background: #f8f9fa;
            color: #666;
            border: 1px solid #e0e0e0;
        }

        .transaction-filter:hover,
        .transaction-filter.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .transaction-list {
            display: grid;
            gap: 15px;
        }

        .transaction-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #f0f0f0;
            transition: all 0.3s;
        }

        .transaction-item:hover {
            background: #f8f9fa;
        }

        .transaction-icon {
            width: 45px;
            height: 45px;
            background: #f0f0f0;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
        }

        .transaction-icon.credit {
            background: #d4edda;
            color: #155724;
        }

        .transaction-icon.debit {
            background: #f8d7da;
            color: #721c24;
        }

        .transaction-details {
            flex: 1;
        }

        .transaction-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }

        .transaction-title {
            font-weight: 600;
            color: var(--dark);
        }

        .transaction-amount {
            font-weight: bold;
        }

        .transaction-amount.credit {
            color: #28a745;
        }

        .transaction-amount.debit {
            color: var(--danger);
        }

        .transaction-info {
            display: flex;
            gap: 15px;
            color: #666;
            font-size: 13px;
        }

        .transaction-info i {
            margin-right: 3px;
            font-size: 12px;
        }

        .transaction-status {
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
        }

        .status-success {
            background: #d4edda;
            color: #155724;
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
        }

        .status-failed {
            background: #f8d7da;
            color: #721c24;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 10000;
            justify-content: center;
            align-items: center;
        }

        .modal.show {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }

        .modal-header h2 {
            color: var(--dark);
        }

        .modal-close {
            cursor: pointer;
            font-size: 24px;
            color: #999;
            transition: color 0.3s;
        }

        .modal-close:hover {
            color: var(--danger);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 14px;
            transition: all 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
        }

        .card-preview {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 15px;
            padding: 20px;
            color: white;
            margin-bottom: 20px;
            position: relative;
            min-height: 180px;
        }

        .card-preview .card-type {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 24px;
        }

        .card-preview .card-number {
            font-size: 20px;
            letter-spacing: 2px;
            margin-top: 40px;
            margin-bottom: 20px;
        }

        .card-preview .card-details {
            display: flex;
            gap: 30px;
        }

        .card-preview .card-holder {
            flex: 1;
        }

        .card-preview .card-expiry {
            text-align: right;
        }

        .card-preview .label {
            font-size: 12px;
            opacity: 0.8;
            margin-bottom: 5px;
        }

        .card-preview .value {
            font-size: 16px;
            font-weight: 600;
        }

        .modal-actions {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        .modal-actions button {
            flex: 1;
            padding: 12px;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .save-btn {
            background: var(--primary);
            color: white;
            border: none;
        }

        .save-btn:hover {
            background: var(--secondary);
        }

        .cancel-btn {
            background: #f8f9fa;
            color: #666;
            border: 1px solid #e0e0e0;
        }

        .cancel-btn:hover {
            background: #e9ecef;
        }

        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
        }

        .toast {
            background: white;
            border-radius: 10px;
            padding: 15px 20px;
            margin-bottom: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            gap: 15px;
            animation: slideIn 0.3s ease;
            max-width: 350px;
        }

        .toast.success {
            border-left: 4px solid #28a745;
        }

        .toast.error {
            border-left: 4px solid #dc3545;
        }

        .toast.info {
            border-left: 4px solid #17a2b8;
        }

        .toast i {
            font-size: 20px;
        }

        .toast.success i {
            color: #28a745;
        }

        .toast.error i {
            color: #dc3545;
        }

        .toast.info i {
            color: #17a2b8;
        }

        .toast-content {
            flex: 1;
        }

        .toast-title {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .toast-message {
            font-size: 14px;
            color: #666;
        }

        .toast-close {
            cursor: pointer;
            color: #999;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .loading-spinner {
            display: inline-block;
            width: 50px;
            height: 50px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .wallet-section {
                flex-direction: column;
                text-align: center;
            }

            .wallet-actions {
                width: 100%;
            }

            .wallet-btn {
                flex: 1;
            }

            .method-item {
                flex-wrap: wrap;
            }

            .method-actions {
                width: 100%;
                justify-content: flex-end;
                margin-top: 10px;
            }

            .transaction-item {
                flex-wrap: wrap;
            }

            .transaction-icon {
                margin-bottom: 10px;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Spinner -->
    <div id="loadingSpinner" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 9999;">
        <div class="loading-spinner"></div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Menu Toggle Button -->
    <button class="menu-toggle" id="menuToggle">
        <i class="fas fa-bars"></i>
    </button>
    
    <!-- Sidebar Overlay -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>
    
    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <img src="https://img.icons8.com/fluency/48/000000/car.png" alt="EasyGo">
                <span>EasyGo</span>
            </div>
            <button class="sidebar-close" id="sidebarClose">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="user-info">
            <img src="https://randomuser.me/api/portraits/men/1.jpg" alt="User" class="user-avatar" id="userAvatar">
            <div class="user-details">
                <h4 class="user-name" id="userName">Thabo Nkosi</h4>
                <p class="user-email" id="userEmail">thabo.nkosi@example.com</p>
                <span class="user-badge" id="userBadge">Premium Member</span>
            </div>
        </div>
        
        <div class="sidebar-search">
            <i class="fas fa-search"></i>
            <input type="text" placeholder="Search...">
        </div>
        
        <ul class="nav-menu">
            <li class="nav-item">
                <a href="rider-dashboard.html" class="nav-link">
                    <i class="fas fa-home"></i>
                    <span>Dashboard</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="ride-booking.html" class="nav-link">
                    <i class="fas fa-car"></i>
                    <span>Book a Ride</span>
                    <span class="nav-badge">New</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="ride-history.html" class="nav-link">
                    <i class="fas fa-history"></i>
                    <span>Ride History</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="rider-payments.html" class="nav-link active">
                    <i class="fas fa-wallet"></i>
                    <span>Payments</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="rider-profile.html" class="nav-link">
                    <i class="fas fa-user"></i>
                    <span>Profile</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="rider-notifications.html" class="nav-link">
                    <i class="fas fa-bell"></i>
                    <span>Notifications</span>
                    <span class="nav-badge notification-dot"></span>
                </a>
            </li>
            <li class="nav-item">
                <a href="rider-support.html" class="nav-link">
                    <i class="fas fa-headset"></i>
                    <span>Support</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="rider-settings.html" class="nav-link">
                    <i class="fas fa-cog"></i>
                    <span>Settings</span>
                </a>
            </li>
            <li class="nav-item logout-item">
                <a href="javascript:void(0)" class="nav-link" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Logout</span>
                </a>
            </li>
        </ul>

        <div class="sidebar-footer">
            <div class="sidebar-progress">
                <div class="progress-info">
                    <span>Ride Points</span>
                    <span>750/1000</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 75%"></div>
                </div>
            </div>
            <div class="sidebar-help" onclick="window.location.href='rider-support.html'">
                <i class="fas fa-question-circle"></i>
                <span>Need Help?</span>
            </div>
        </div>
    </div>
    
    <!-- Main Content -->
    <div class="main-content">
        <div class="container">
            <!-- Page Header -->
            <div class="page-header">
                <div class="page-title">
                    <h1>Payments</h1>
                    <p>Manage your wallet, payment methods and transaction history</p>
                </div>
                <button class="add-payment-btn" onclick="showAddPaymentModal()">
                    <i class="fas fa-plus-circle"></i> Add Payment Method
                </button>
            </div>

            <!-- Wallet Section -->
            <div class="wallet-section">
                <div class="wallet-info">
                    <h3>EasyGo Wallet Balance</h3>
                    <div class="wallet-balance">R 2,450.00</div>
                    <div class="wallet-label">Available for rides</div>
                </div>
                <div class="wallet-actions">
                    <button class="wallet-btn" onclick="showTopUpModal()">
                        <i class="fas fa-plus-circle"></i> Top Up
                    </button>
                    <button class="wallet-btn" onclick="showWithdrawModal()">
                        <i class="fas fa-arrow-up"></i> Withdraw
                    </button>
                </div>
            </div>

            <!-- Payment Summary -->
            <div class="payment-summary">
                <div class="summary-card">
                    <div class="summary-icon">
                        <i class="fas fa-credit-card"></i>
                    </div>
                    <div class="summary-info">
                        <h3>Total Spent</h3>
                        <div class="number">R 38,450</div>
                    </div>
                </div>
                <div class="summary-card">
                    <div class="summary-icon">
                        <i class="fas fa-wallet"></i>
                    </div>
                    <div class="summary-info">
                        <h3>Wallet Balance</h3>
                        <div class="number">R 2,450</div>
                    </div>
                </div>
                <div class="summary-card">
                    <div class="summary-icon">
                        <i class="fas fa-exchange-alt"></i>
                    </div>
                    <div class="summary-info">
                        <h3>Transactions</h3>
                        <div class="number">156</div>
                    </div>
                </div>
                <div class="summary-card">
                    <div class="summary-icon">
                        <i class="fas fa-gift"></i>
                    </div>
                    <div class="summary-info">
                        <h3>Cashback Earned</h3>
                        <div class="number">R 850</div>
                    </div>
                </div>
            </div>

            <!-- Payment Methods -->
            <div class="payment-methods">
                <div class="section-header">
                    <h2>Saved Payment Methods</h2>
                    <button onclick="showAddPaymentModal()">
                        <i class="fas fa-plus"></i> Add New
                    </button>
                </div>
                
                <div class="method-list" id="paymentMethodsList">
                    <!-- Payment methods will be loaded here -->
                </div>
            </div>

            <!-- Transactions -->
            <div class="transactions-section">
                <div class="section-header">
                    <h2>Transaction History</h2>
                    <button onclick="exportTransactions()">
                        <i class="fas fa-download"></i> Export
                    </button>
                </div>

                <div class="transaction-filters">
                    <span class="transaction-filter active" onclick="filterTransactions('all', this)">All</span>
                    <span class="transaction-filter" onclick="filterTransactions('credit', this)">Credits</span>
                    <span class="transaction-filter" onclick="filterTransactions('debit', this)">Debits</span>
                    <span class="transaction-filter" onclick="filterTransactions('wallet', this)">Wallet</span>
                    <span class="transaction-filter" onclick="filterTransactions('card', this)">Card</span>
                </div>

                <div class="transaction-list" id="transactionList">
                    <!-- Transactions will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Add Payment Method Modal -->
    <div class="modal" id="addPaymentModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add Payment Method</h2>
                <span class="modal-close" onclick="closeModal('addPaymentModal')">&times;</span>
            </div>
            
            <div class="card-preview" id="cardPreview">
                <div class="card-type">
                    <i class="fab fa-cc-visa"></i>
                </div>
                <div class="card-number">**** **** **** 4242</div>
                <div class="card-details">
                    <div class="card-holder">
                        <div class="label">Card Holder</div>
                        <div class="value">John Doe</div>
                    </div>
                    <div class="card-expiry">
                        <div class="label">Expires</div>
                        <div class="value">12/25</div>
                    </div>
                </div>
            </div>

            <form id="paymentMethodForm" onsubmit="savePaymentMethod(event)">
                <div class="form-group">
                    <label>Card Type</label>
                    <select id="cardType" onchange="updateCardPreview()">
                        <option value="visa">Visa</option>
                        <option value="mastercard">Mastercard</option>
                        <option value="amex">American Express</option>
                        <option value="discover">Discover</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Card Number</label>
                    <input type="text" id="cardNumber" placeholder="1234 5678 9012 3456" maxlength="19" oninput="formatCardNumber(this); updateCardPreview()">
                </div>

                <div class="form-group">
                    <label>Card Holder Name</label>
                    <input type="text" id="cardHolder" placeholder="John Doe" oninput="updateCardPreview()">
                </div>

                <div class="form-group">
                    <label>Expiry Date</label>
                    <input type="text" id="expiryDate" placeholder="MM/YY" maxlength="5" oninput="formatExpiry(this); updateCardPreview()">
                </div>

                <div class="form-group">
                    <label>CVV</label>
                    <input type="text" id="cvv" placeholder="123" maxlength="4">
                </div>

                <div class="form-group">
                    <label>
                        <input type="checkbox" id="setDefault"> Set as default payment method
                    </label>
                </div>

                <div class="modal-actions">
                    <button type="button" class="cancel-btn" onclick="closeModal('addPaymentModal')">Cancel</button>
                    <button type="submit" class="save-btn">Save Payment Method</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Top Up Wallet Modal -->
    <div class="modal" id="topUpModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Top Up Wallet</h2>
                <span class="modal-close" onclick="closeModal('topUpModal')">&times;</span>
            </div>
            
            <div class="wallet-balance-modal" style="text-align: center; margin-bottom: 20px;">
                <h3>Current Balance</h3>
                <div style="font-size: 36px; font-weight: bold; color: var(--primary);">R 2,450.00</div>
            </div>

            <div class="quick-amounts" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 20px;">
                <button class="wallet-btn" style="background: var(--primary); color: white; border: none;" onclick="setTopUpAmount(50)">R 50</button>
                <button class="wallet-btn" style="background: var(--primary); color: white; border: none;" onclick="setTopUpAmount(100)">R 100</button>
                <button class="wallet-btn" style="background: var(--primary); color: white; border: none;" onclick="setTopUpAmount(200)">R 200</button>
                <button class="wallet-btn" style="background: var(--primary); color: white; border: none;" onclick="setTopUpAmount(500)">R 500</button>
                <button class="wallet-btn" style="background: var(--primary); color: white; border: none;" onclick="setTopUpAmount(1000)">R 1000</button>
                <button class="wallet-btn" style="background: var(--primary); color: white; border: none;" onclick="setTopUpAmount(2000)">R 2000</button>
            </div>

            <form onsubmit="processTopUp(event)">
                <div class="form-group">
                    <label>Enter Amount (R)</label>
                    <input type="number" id="topUpAmount" placeholder="Enter amount" min="10" step="10" required>
                </div>

                <div class="form-group">
                    <label>Payment Method</label>
                    <select id="topUpMethod" required>
                        <option value="">Select payment method</option>
                        <option value="card1">Visa •••• 4242</option>
                        <option value="card2">Mastercard •••• 8888</option>
                        <option value="new">+ Add new card</option>
                    </select>
                </div>

                <div class="modal-actions">
                    <button type="button" class="cancel-btn" onclick="closeModal('topUpModal')">Cancel</button>
                    <button type="submit" class="save-btn">Proceed to Payment</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Transaction Details Modal -->
    <div class="modal" id="transactionModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Transaction Details</h2>
                <span class="modal-close" onclick="closeModal('transactionModal')">&times;</span>
            </div>
            <div id="transactionDetailsContent">
                <!-- Dynamic content will be loaded here -->
            </div>
        </div>
    </div>

    <script src="assets/js/auth.js"></script>
    <script src="assets/js/sidebar.js"></script>
    <script>
        // Sample payment methods data
        const paymentMethods = [
            {
                id: 1,
                type: 'visa',
                last4: '4242',
                holder: 'Thabo Nkosi',
                expiry: '12/25',
                isDefault: true
            },
            {
                id: 2,
                type: 'mastercard',
                last4: '8888',
                holder: 'Thabo Nkosi',
                expiry: '08/24',
                isDefault: false
            },
            {
                id: 3,
                type: 'paypal',
                email: 'thabo.nkosi@example.com',
                isDefault: false
            }
        ];

        // Sample transactions data
        const transactions = [
            {
                id: 1,
                type: 'debit',
                title: 'Ride to OR Tambo Airport',
                amount: 350,
                date: '2024-11-20',
                time: '09:30',
                status: 'success',
                paymentMethod: 'Visa •••• 4242',
                reference: 'TXN123456789'
            },
            {
                id: 2,
                type: 'debit',
                title: 'Ride to Fourways Mall',
                amount: 180,
                date: '2024-11-19',
                time: '18:45',
                status: 'success',
                paymentMethod: 'Wallet',
                reference: 'TXN123456790'
            },
            {
                id: 3,
                type: 'credit',
                title: 'Wallet Top Up',
                amount: 500,
                date: '2024-11-18',
                time: '10:15',
                status: 'success',
                paymentMethod: 'Mastercard •••• 8888',
                reference: 'TXN123456791'
            },
            {
                id: 4,
                type: 'debit',
                title: 'Ride to Umhlanga Ridge',
                amount: 120,
                date: '2024-11-18',
                time: '22:15',
                status: 'failed',
                paymentMethod: 'Wallet',
                reference: 'TXN123456792'
            },
            {
                id: 5,
                type: 'credit',
                title: 'Cashback Reward',
                amount: 25,
                date: '2024-11-17',
                time: '14:30',
                status: 'success',
                paymentMethod: 'Wallet',
                reference: 'TXN123456793'
            },
            {
                id: 6,
                type: 'debit',
                title: 'Ride to Cape Town Airport',
                amount: 280,
                date: '2024-11-16',
                time: '08:20',
                status: 'pending',
                paymentMethod: 'Visa •••• 4242',
                reference: 'TXN123456794'
            }
        ];

        let currentTransactionFilter = 'all';

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            loadPaymentMethods();
            loadTransactions();
        });

        // Load payment methods
        function loadPaymentMethods() {
            const container = document.getElementById('paymentMethodsList');
            if (!container) return;

            container.innerHTML = '';
            paymentMethods.forEach(method => {
                container.appendChild(createPaymentMethodElement(method));
            });
        }

        // Create payment method element
        function createPaymentMethodElement(method) {
            const div = document.createElement('div');
            div.className = `method-item ${method.isDefault ? 'default' : ''}`;

            let icon = '';
            let details = '';

            if (method.type === 'paypal') {
                icon = '<i class="fab fa-paypal"></i>';
                details = `
                    <h4>PayPal</h4>
                    <p>${method.email}</p>
                `;
            } else {
                const cardIcons = {
                    visa: 'fab fa-cc-visa',
                    mastercard: 'fab fa-cc-mastercard',
                    amex: 'fab fa-cc-amex',
                    discover: 'fab fa-cc-discover'
                };
                icon = `<i class="${cardIcons[method.type] || 'fas fa-credit-card'}"></i>`;
                details = `
                    <h4>${method.type.charAt(0).toUpperCase() + method.type.slice(1)} •••• ${method.last4}</h4>
                    <p>Expires ${method.expiry}</p>
                `;
            }

            div.innerHTML = `
                <div class="method-icon">
                    ${icon}
                </div>
                <div class="method-details">
                    ${details}
                </div>
                ${method.isDefault ? '<span class="method-badge">Default</span>' : ''}
                <div class="method-actions">
                    <button class="method-btn" onclick="setDefaultPayment(${method.id})" title="Set as default">
                        <i class="fas fa-check-circle"></i>
                    </button>
                    <button class="method-btn" onclick="editPaymentMethod(${method.id})" title="Edit">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="method-btn delete" onclick="deletePaymentMethod(${method.id})" title="Delete">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `;

            return div;
        }

        // Load transactions
        function loadTransactions() {
            const container = document.getElementById('transactionList');
            if (!container) return;

            let filteredTransactions = transactions;
            if (currentTransactionFilter !== 'all') {
                filteredTransactions = transactions.filter(t => 
                    currentTransactionFilter === 'credit' ? t.type === 'credit' :
                    currentTransactionFilter === 'debit' ? t.type === 'debit' :
                    t.paymentMethod.toLowerCase().includes(currentTransactionFilter)
                );
            }

            container.innerHTML = '';
            filteredTransactions.forEach(transaction => {
                container.appendChild(createTransactionElement(transaction));
            });
        }

        // Create transaction element
        function createTransactionElement(transaction) {
            const div = document.createElement('div');
            div.className = 'transaction-item';
            div.onclick = () => showTransactionDetails(transaction);

            const date = new Date(transaction.date);
            const formattedDate = date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });

            div.innerHTML = `
                <div class="transaction-icon ${transaction.type}">
                    <i class="fas ${transaction.type === 'credit' ? 'fa-arrow-down' : 'fa-arrow-up'}"></i>
                </div>
                <div class="transaction-details">
                    <div class="transaction-header">
                        <span class="transaction-title">${transaction.title}</span>
                        <span class="transaction-amount ${transaction.type}">
                            ${transaction.type === 'credit' ? '+' : '-'}R ${transaction.amount}
                        </span>
                    </div>
                    <div class="transaction-info">
                        <span><i class="far fa-calendar"></i> ${formattedDate}</span>
                        <span><i class="far fa-clock"></i> ${transaction.time}</span>
                        <span><i class="fas fa-credit-card"></i> ${transaction.paymentMethod}</span>
                    </div>
                </div>
                <span class="transaction-status status-${transaction.status}">${transaction.status}</span>
            `;

            return div;
        }

        // Filter transactions
        function filterTransactions(filter, element) {
            currentTransactionFilter = filter;
            
            document.querySelectorAll('.transaction-filter').forEach(el => {
                el.classList.remove('active');
            });
            element.classList.add('active');
            
            loadTransactions();
        }

        // Show transaction details
        function showTransactionDetails(transaction) {
            const modal = document.getElementById('transactionModal');
            const content = document.getElementById('transactionDetailsContent');

            const date = new Date(transaction.date);
            const formattedDate = date.toLocaleDateString('en-US', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });

            content.innerHTML = `
                <div style="text-align: center; margin-bottom: 20px;">
                    <div style="font-size: 48px; color: ${transaction.type === 'credit' ? '#28a745' : '#f72585'}; margin-bottom: 10px;">
                        <i class="fas ${transaction.type === 'credit' ? 'fa-arrow-down' : 'fa-arrow-up'}"></i>
                    </div>
                    <div style="font-size: 32px; font-weight: bold; color: var(--dark);">
                        ${transaction.type === 'credit' ? '+' : '-'}R ${transaction.amount}
                    </div>
                </div>

                <div style="background: #f8f9fa; border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                    <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #e0e0e0;">
                        <span style="color: #666;">Transaction ID</span>
                        <span style="font-weight: 600; color: var(--dark);">${transaction.reference}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #e0e0e0;">
                        <span style="color: #666;">Description</span>
                        <span style="font-weight: 600; color: var(--dark);">${transaction.title}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #e0e0e0;">
                        <span style="color: #666;">Date & Time</span>
                        <span style="font-weight: 600; color: var(--dark);">${formattedDate} at ${transaction.time}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #e0e0e0;">
                        <span style="color: #666;">Payment Method</span>
                        <span style="font-weight: 600; color: var(--dark);">${transaction.paymentMethod}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 8px 0;">
                        <span style="color: #666;">Status</span>
                        <span style="font-weight: 600; color: var(--dark);">
                            <span class="transaction-status status-${transaction.status}">${transaction.status}</span>
                        </span>
                    </div>
                </div>

                <div style="display: flex; gap: 15px; margin-top: 20px;">
                    <button class="save-btn" onclick="downloadReceipt('${transaction.reference}')" style="flex: 1;">
                        <i class="fas fa-download"></i> Download Receipt
                    </button>
                    <button class="cancel-btn" onclick="reportIssue('${transaction.reference}')" style="flex: 1;">
                        <i class="fas fa-flag"></i> Report Issue
                    </button>
                </div>
            `;

            modal.classList.add('show');
        }

        // Show add payment modal
        function showAddPaymentModal() {
            document.getElementById('addPaymentModal').classList.add('show');
        }

        // Show top up modal
        function showTopUpModal() {
            document.getElementById('topUpModal').classList.add('show');
        }

        // Show withdraw modal
        function showWithdrawModal() {
            showToast('Withdraw', 'Withdrawal feature coming soon!', 'info');
        }

        // Close modal
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('show');
        }

        // Format card number
        function formatCardNumber(input) {
            let value = input.value.replace(/\s/g, '').replace(/\D/g, '');
            let formattedValue = '';
            
            for (let i = 0; i < value.length; i++) {
                if (i > 0 && i % 4 === 0) {
                    formattedValue += ' ';
                }
                formattedValue += value[i];
            }
            
            input.value = formattedValue;
            updateCardPreview();
        }

        // Format expiry
        function formatExpiry(input) {
            let value = input.value.replace(/\D/g, '');
            if (value.length >= 2) {
                value = value.substring(0, 2) + '/' + value.substring(2, 4);
            }
            input.value = value;
            updateCardPreview();
        }

        // Update card preview
        function updateCardPreview() {
            const cardType = document.getElementById('cardType').value;
            const cardNumber = document.getElementById('cardNumber').value || '**** **** **** 4242';
            const cardHolder = document.getElementById('cardHolder').value || 'John Doe';
            const expiryDate = document.getElementById('expiryDate').value || '12/25';

            const preview = document.getElementById('cardPreview');
            const typeIcons = {
                visa: 'fab fa-cc-visa',
                mastercard: 'fab fa-cc-mastercard',
                amex: 'fab fa-cc-amex',
                discover: 'fab fa-cc-discover'
            };

            preview.innerHTML = `
                <div class="card-type">
                    <i class="${typeIcons[cardType] || 'fas fa-credit-card'}"></i>
                </div>
                <div class="card-number">${cardNumber}</div>
                <div class="card-details">
                    <div class="card-holder">
                        <div class="label">Card Holder</div>
                        <div class="value">${cardHolder}</div>
                    </div>
                    <div class="card-expiry">
                        <div class="label">Expires</div>
                        <div class="value">${expiryDate}</div>
                    </div>
                </div>
            `;
        }

        // Set top up amount
        function setTopUpAmount(amount) {
            document.getElementById('topUpAmount').value = amount;
        }

        // Save payment method
        function savePaymentMethod(event) {
            event.preventDefault();
            closeModal('addPaymentModal');
            showToast('Success', 'Payment method added successfully!', 'success');
        }

        // Process top up
        function processTopUp(event) {
            event.preventDefault();
            const amount = document.getElementById('topUpAmount').value;
            closeModal('topUpModal');
            showToast('Success', `Wallet topped up with R ${amount}!`, 'success');
        }

        // Set default payment
        function setDefaultPayment(methodId) {
            paymentMethods.forEach(m => m.isDefault = false);
            const method = paymentMethods.find(m => m.id === methodId);
            if (method) method.isDefault = true;
            loadPaymentMethods();
            showToast('Success', 'Default payment method updated!', 'success');
        }

        // Edit payment method
        function editPaymentMethod(methodId) {
            showToast('Edit', 'Edit payment method feature coming soon!', 'info');
        }

        // Delete payment method
        function deletePaymentMethod(methodId) {
            if (confirm('Are you sure you want to delete this payment method?')) {
                const index = paymentMethods.findIndex(m => m.id === methodId);
                if (index !== -1) paymentMethods.splice(index, 1);
                loadPaymentMethods();
                showToast('Success', 'Payment method deleted!', 'success');
            }
        }

        // Export transactions
        function exportTransactions() {
            showToast('Export', 'Transaction history is being exported to CSV', 'success');
        }

        // Download receipt
        function downloadReceipt(reference) {
            showToast('Download', `Receipt ${reference} is being downloaded`, 'success');
        }

        // Report issue
        function reportIssue(reference) {
            showToast('Report', `Issue reported for transaction ${reference}`, 'info');
        }

        // Logout function
        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                window.location.href = 'login.html';
            }
        }

        // Show toast
        function showToast(title, message, type = 'info') {
            const container = document.getElementById('toastContainer');
            if (!container) return;
            
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            const icon = type === 'success' ? 'check-circle' : 
                        type === 'error' ? 'exclamation-circle' : 
                        type === 'warning' ? 'exclamation-triangle' : 'info-circle';
            
            toast.innerHTML = `
                <i class="fas fa-${icon}"></i>
                <div class="toast-content">
                    <div class="toast-title">${title}</div>
                    <div class="toast-message">${message}</div>
                </div>
                <i class="fas fa-times toast-close" onclick="this.parentElement.remove()"></i>
            `;
            
            container.appendChild(toast);
            
            setTimeout(() => {
                if (toast.parentElement) {
                    toast.remove();
                }
            }, 5000);
        }
    </script>
</body>
</html>