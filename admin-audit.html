<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EasyGo - Audit Logs (Production Ready)</title>
    <!-- ===== EXACT SAME CSS FILES AS ORIGINAL ADMIN PANEL ===== -->
    <link rel="stylesheet" href="assets/css/main.css">
    <link rel="stylesheet" href="assets/css/sidebar.css">
    <link rel="stylesheet" href="assets/css/responsive.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- additional audit-specific styles (keep original design language) -->
    <style>
        /* ===== AUDIT LOGS SPECIFIC STYLES (extends original panel classes) ===== */
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 15px;
        }
        .page-title h1 {
            font-size: 28px;
            color: #333;
            margin-bottom: 5px;
        }
        .page-title p {
            color: #666;
            font-size: 14px;
        }
        .action-bar {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }
        .search-box {
            display: flex;
            align-items: center;
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 8px 15px;
            min-width: 300px;
        }
        .search-box i {
            color: #999;
            margin-right: 10px;
        }
        .search-box input {
            border: none;
            outline: none;
            width: 100%;
            font-size: 14px;
        }
        .filter-btn {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 8px 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            color: #495057;
            font-weight: 500;
            transition: all 0.2s;
        }
        .filter-btn:hover {
            background: #f1f4f9;
            border-color: #b0c0d0;
        }
        .export-btn {
            background: #28a745;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 8px 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            transition: background 0.2s;
        }
        .export-btn:hover {
            background: #218838;
        }
        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: transform 0.2s;
            border-left: 4px solid #667eea;
        }
        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 18px rgba(0,0,0,0.08);
        }
        .stat-card h3 {
            font-size: 14px;
            color: #666;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }
        .stat-number {
            font-size: 30px;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 5px;
        }
        .stat-trend {
            font-size: 12px;
            color: #28a745;
        }
        /* data-table uses exact same class as original, we just extend filter row */
        .filter-bar {
            display: flex;
            gap: 12px;
            align-items: center;
            flex-wrap: wrap;
            margin-bottom: 20px;
            background: #f8fafd;
            padding: 12px 16px;
            border-radius: 12px;
        }
        .filter-select {
            padding: 8px 28px 8px 14px;
            border: 1px solid #d2dce8;
            border-radius: 30px;
            background: white;
            font-size: 13px;
            color: #2c3e50;
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23333' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'><polyline points='6 9 12 15 18 9'/></svg>");
            background-repeat: no-repeat;
            background-position: right 10px center;
        }
        .date-range {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        .date-input {
            padding: 8px 12px;
            border: 1px solid #d2dce8;
            border-radius: 30px;
            font-size: 13px;
        }
        .badge {
            padding: 5px 12px;
            border-radius: 30px;
            font-size: 12px;
            font-weight: 600;
            display: inline-block;
        }
        .badge-info { background: #e3f2fd; color: #0b5e8a; }
        .badge-warning { background: #fff3cd; color: #856404; }
        .badge-success { background: #d4edda; color: #155724; }
        .badge-danger { background: #f8d7da; color: #721c24; }
        .badge-secondary { background: #e2e3e5; color: #383d41; }
        .avatar-icon {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: #667eea20;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            color: #4a5a99;
            font-size: 13px;
            font-weight: 600;
            margin-right: 8px;
        }
        .user-cell {
            display: flex;
            align-items: center;
        }
        .detail-hover {
            cursor: pointer;
            color: #667eea;
            font-weight: 500;
        }
        .detail-hover:hover {
            text-decoration: underline;
        }
        /* modal (hidden by default) */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }
        .modal.active {
            display: flex;
        }
        .modal-content {
            background: white;
            border-radius: 20px;
            width: 90%;
            max-width: 550px;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
            animation: slideUp 0.3s ease;
        }
        @keyframes slideUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .modal-header {
            padding: 22px 28px;
            border-bottom: 1px solid #eef2f6;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .modal-header h2 {
            font-size: 22px;
            color: #1e293b;
        }
        .close-modal {
            background: none;
            border: none;
            font-size: 26px;
            cursor: pointer;
            color: #7e8c9e;
        }
        .modal-body {
            padding: 24px 28px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            font-weight: 600;
            font-size: 14px;
            color: #2c3e50;
            margin-bottom: 6px;
            display: block;
        }
        .form-control {
            width: 100%;
            padding: 12px 16px;
            border: 1.5px solid #e1e8f0;
            border-radius: 12px;
            font-size: 14px;
            transition: 0.2s;
        }
        .form-control:focus {
            border-color: #667eea;
            outline: none;
            box-shadow: 0 0 0 3px rgba(102,126,234,0.15);
        }
        .modal-footer {
            padding: 18px 28px;
            border-top: 1px solid #eef2f6;
            text-align: right;
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }
        .btn-primary {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 40px;
            font-weight: 600;
            cursor: pointer;
            transition: 0.2s;
        }
        .btn-primary:hover { background: #5a67d8; }
        .btn-secondary {
            background: white;
            border: 1px solid #bcc9d9;
            padding: 12px 30px;
            border-radius: 40px;
            font-weight: 600;
            cursor: pointer;
            color: #405570;
        }
        .btn-secondary:hover { background: #f1f5f9; }
        .toast {
            visibility: hidden;
            min-width: 280px;
            background: #2d3e50;
            color: white;
            text-align: center;
            border-radius: 50px;
            padding: 14px 24px;
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s, visibility 0.3s;
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
            z-index: 2100;
        }
        .toast.show {
            visibility: visible;
            opacity: 1;
        }
        /* pagination same as original with active */
        .pagination {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 30px;
        }
        .page-item {
            padding: 8px 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            cursor: pointer;
            color: #666;
            background: white;
            transition: all 0.2s;
        }
        .page-item.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
        .page-item:hover:not(.active) {
            background: #f0f3f8;
        }
        /* additional utility */
        .text-muted { color: #7b8a9b; }
    </style>
</head>
<body>
    <!-- Menu Toggle (identical) -->
    <button class="menu-toggle" id="menuToggle">
        <i class="fas fa-bars"></i>
    </button>
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <!-- SIDEBAR (exact copy with active on Audit Logs) -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <img src="https://img.icons8.com/fluency/48/000000/car.png" alt="EasyGo">
                <span>EasyGo Admin</span>
            </div>
            <div class="user-info">
                <img src="https://randomuser.me/api/portraits/men/5.jpg" alt="Admin" class="user-avatar" id="userAvatar">
                <div class="user-details">
                    <h4 class="user-name" id="userName">Bongani Mkhize</h4>
                    <p>Operations Manager</p>
                </div>
            </div>
        </div>

        <ul class="nav-menu">
            <li class="nav-item"><a href="admin-panel.html" class="nav-link"><img src="https://img.icons8.com/ios-filled/50/000000/dashboard.png" alt="Dashboard"><span>Dashboard</span></a></li>
            <li class="nav-item"><a href="admin-users.html" class="nav-link"><img src="https://img.icons8.com/ios-filled/50/000000/user-group-man-man.png" alt="Users"><span>Users</span></a></li>
            <li class="nav-item"><a href="admin-drivers.html" class="nav-link"><img src="https://img.icons8.com/ios-filled/50/000000/driver.png" alt="Drivers"><span>Drivers</span></a></li>
            <li class="nav-item"><a href="admin-trips.html" class="nav-link"><img src="https://img.icons8.com/ios-filled/50/000000/car.png" alt="Trips"><span>Trips</span></a></li>
            <li class="nav-item"><a href="admin-payments.html" class="nav-link"><img src="https://img.icons8.com/ios-filled/50/000000/money.png" alt="Payments"><span>Payments</span></a></li>
            <li class="nav-item"><a href="admin-reports.html" class="nav-link"><img src="https://img.icons8.com/ios-filled/50/000000/analytics.png" alt="Reports"><span>Reports</span></a></li>
            <li class="nav-item"><a href="admin-verification.html" class="nav-link"><img src="https://img.icons8.com/ios-filled/50/000000/approval.png" alt="Verification"><span>Verification</span></a></li>
            <li class="nav-item"><a href="admin-support.html" class="nav-link"><img src="https://img.icons8.com/ios-filled/50/000000/support.png" alt="Support"><span>Support</span></a></li>
            <li class="nav-item"><a href="admin-promotions.html" class="nav-link"><img src="https://img.icons8.com/ios-filled/50/000000/discount.png" alt="Promotions"><span>Promotions</span></a></li>
            <li class="nav-item"><a href="admin-fleet.html" class="nav-link"><img src="https://img.icons8.com/ios-filled/50/000000/truck.png" alt="Fleet"><span>Fleet</span></a></li>
            <li class="nav-item"><a href="admin-zones.html" class="nav-link"><img src="https://img.icons8.com/ios-filled/50/000000/map.png" alt="Zones"><span>Zones</span></a></li>
            <li class="nav-item"><a href="admin-audit.html" class="nav-link active"><img src="https://img.icons8.com/ios-filled/50/000000/activity-log.png" alt="Audit"><span>Audit Logs</span></a></li>
            <li class="nav-item"><a href="admin-incidents.html" class="nav-link"><img src="https://img.icons8.com/ios-filled/50/000000/emergency-button.png" alt="Incidents"><span>Incidents</span></a></li>
            <li class="nav-item"><a href="admin-reviews.html" class="nav-link"><img src="https://img.icons8.com/ios-filled/50/000000/star.png" alt="Reviews"><span>Reviews</span></a></li>
            <li class="nav-item"><a href="admin-admins.html" class="nav-link"><img src="https://img.icons8.com/ios-filled/50/000000/admin-settings-male.png" alt="Admins"><span>Admin Users</span></a></li>
            <li class="nav-item"><a href="admin-settings.html" class="nav-link"><img src="https://img.icons8.com/ios-filled/50/000000/settings.png" alt="Settings"><span>Settings</span></a></li>
            <li class="nav-item"><a href="javascript:void(0)" class="nav-link" onclick="logout()"><img src="https://img.icons8.com/ios-filled/50/000000/exit.png" alt="Logout"><span>Logout</span></a></li>
        </ul>
    </div>

    <!-- MAIN CONTENT (Audit Logs) -->
    <div class="main-content">
        <div class="container">
            <!-- Page Header with Search and Actions -->
            <div class="page-header">
                <div class="page-title">
                    <h1>Audit Logs</h1>
                    <p>Comprehensive trail of all administrative actions and system events</p>
                </div>
                <div class="action-bar">
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" id="searchInput" placeholder="Search by user, action, or IP...">
                    </div>
                    <button class="filter-btn" id="filterToggleBtn"><i class="fas fa-filter"></i> Filters</button>
                    <button class="export-btn" onclick="exportLogs()"><i class="fas fa-download"></i> Export</button>
                </div>
            </div>

            <!-- Filter bar (expandable) -->
            <div id="filterBar" style="display: none; margin-bottom: 20px;">
                <div class="filter-bar">
                    <select class="filter-select" id="actionTypeFilter">
                        <option value="">All action types</option>
                        <option value="create">CREATE</option>
                        <option value="update">UPDATE</option>
                        <option value="delete">DELETE</option>
                        <option value="login">LOGIN</option>
                        <option value="settings">SETTINGS</option>
                    </select>
                    <select class="filter-select" id="userFilter">
                        <option value="">All admins</option>
                        <option value="bongani">Bongani M.</option>
                        <option value="thabo">Thabo N.</option>
                        <option value="lerato">Lerato M.</option>
                    </select>
                    <div class="date-range">
                        <input type="date" class="date-input" id="startDate" placeholder="From">
                        <span>—</span>
                        <input type="date" class="date-input" id="endDate" placeholder="To">
                    </div>
                    <button class="action-btn edit" onclick="applyFilters()" style="padding:8px 24px;">Apply</button>
                    <button class="action-btn view" onclick="resetFilters()" style="padding:8px 20px;">Reset</button>
                </div>
            </div>

            <!-- Stats Cards -->
            <div class="stats-cards">
                <div class="stat-card"><h3>Total Events</h3><div class="stat-number" id="statTotal">12,834</div><div class="stat-trend">↑ 8% from last month</div></div>
                <div class="stat-card"><h3>Unique Users</h3><div class="stat-number" id="statUsers">24</div><div class="stat-trend">active admins</div></div>
                <div class="stat-card"><h3>Actions (7d)</h3><div class="stat-number" id="statWeek">1,456</div><div class="stat-trend">+124 vs prior week</div></div>
                <div class="stat-card"><h3>Security Events</h3><div class="stat-number" id="statSecurity">32</div><div class="stat-trend">⚠️ 2 failed logins</div></div>
            </div>

            <!-- Data Table (audit logs) -->
            <div class="data-table">
                <div class="table-header">
                    <h2>Event Logs <span style="font-size:14px; font-weight:normal; margin-left:15px; color:#5e6f8d;" id="tableEntryInfo">showing 10 of 12,834</span></h2>
                    <div><i class="fas fa-sync-alt" style="color:#667eea; cursor:pointer;" onclick="refreshLogs()" title="Refresh"></i></div>
                </div>

                <table id="auditTable">
                    <thead>
                        <tr>
                            <th>Timestamp</th>
                            <th>Admin / User</th>
                            <th>Action Type</th>
                            <th>Description</th>
                            <th>IP Address</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="auditTableBody">
                        <!-- dynamically populated by javascript -->
                    </tbody>
                </table>

                <!-- Pagination -->
                <div class="pagination" id="paginationControls">
                    <!-- injected via js -->
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL: Add / View Details (reused for both) -->
    <div id="auditModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Audit Log Details</h2>
                <button class="close-modal" onclick="closeModal()"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body" id="modalBodyContent">
                <!-- filled dynamically -->
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeModal()">Close</button>
                <button class="btn-primary" id="modalActionBtn" style="display: none;">Save</button>
            </div>
        </div>
    </div>

    <!-- TOAST notification -->
    <div id="toast" class="toast">Action completed</div>

    <!-- SCRIPTS (auth.js and sidebar.js as per original) -->
    <script src="assets/js/auth.js"></script>
    <script src="assets/js/sidebar.js"></script>
    <script>
        (function() {
            // ---------- MOCK PRODUCTION DATA (simulates real audit logs) ----------
            const mockLogs = [
                { id: 1, ts: '2026-02-17 09:23:45', admin: 'Bongani M.', action: 'LOGIN', desc: 'Successful login from admin panel', ip: '192.168.1.45', status: 'success', avatar: 'BM' },
                { id: 2, ts: '2026-02-17 08:12:10', admin: 'Lerato M.', action: 'UPDATE', desc: 'Modified driver payout rate for region JHB', ip: '10.0.0.23', status: 'success', avatar: 'LM' },
                { id: 3, ts: '2026-02-16 22:45:03', admin: 'System', action: 'SECURITY', desc: 'Failed login attempt (invalid MFA)', ip: '45.123.32.11', status: 'failed', avatar: 'SY' },
                { id: 4, ts: '2026-02-16 16:30:22', admin: 'Thabo N.', action: 'CREATE', desc: 'New promotion code SUMMER21 created', ip: '192.168.1.102', status: 'success', avatar: 'TN' },
                { id: 5, ts: '2026-02-16 11:05:47', admin: 'Bongani M.', action: 'DELETE', desc: 'Removed expired driver document #D-8823', ip: '192.168.1.45', status: 'success', avatar: 'BM' },
                { id: 6, ts: '2026-02-15 14:19:33', admin: 'Nosipho K.', action: 'SETTINGS', desc: 'Changed company support email', ip: '10.0.0.78', status: 'success', avatar: 'NK' },
                { id: 7, ts: '2026-02-15 10:02:11', admin: 'System', action: 'AUDIT', desc: 'Audit log retention policy executed', ip: '127.0.0.1', status: 'info', avatar: 'SY' },
                { id: 8, ts: '2026-02-14 23:14:56', admin: 'Lerato M.', action: 'LOGIN', desc: 'Logout (session expiry)', ip: '10.0.0.23', status: 'info', avatar: 'LM' },
                { id: 9, ts: '2026-02-14 18:47:21', admin: 'Bongani M.', action: 'UPDATE', desc: 'Updated zone fares (CPT)', ip: '192.168.1.45', status: 'success', avatar: 'BM' },
                { id: 10, ts: '2026-02-14 09:30:02', admin: 'Thabo N.', action: 'VERIFY', desc: 'Approved driver license #DL-4421', ip: '192.168.1.102', status: 'success', avatar: 'TN' },
            ];
            let currentLogs = [...mockLogs];
            let currentPage = 1;
            const rowsPerPage = 7;
            let filteredLogs = [...mockLogs];

            // DOM elements
            const tbody = document.getElementById('auditTableBody');
            const paginationDiv = document.getElementById('paginationControls');
            const searchInput = document.getElementById('searchInput');
            const filterToggleBtn = document.getElementById('filterToggleBtn');
            const filterBar = document.getElementById('filterBar');
            const statTotal = document.getElementById('statTotal');
            const statUsers = document.getElementById('statUsers');
            const statWeek = document.getElementById('statWeek');
            const statSecurity = document.getElementById('statSecurity');
            const tableEntryInfo = document.getElementById('tableEntryInfo');

            // Initialize
            function init() {
                renderTable();
                updateStats();
                attachEvents();
                // sidebar toggle from original
                const menuToggle = document.getElementById('menuToggle');
                const sidebar = document.getElementById('sidebar');
                const overlay = document.getElementById('sidebarOverlay');
                if (menuToggle) {
                    menuToggle.addEventListener('click', function() {
                        sidebar.classList.toggle('active');
                        overlay.classList.toggle('active');
                    });
                }
                if (overlay) {
                    overlay.addEventListener('click', function() {
                        sidebar.classList.remove('active');
                        overlay.classList.remove('active');
                    });
                }
            }

            // Render table based on filteredLogs and currentPage
            function renderTable() {
                const start = (currentPage - 1) * rowsPerPage;
                const end = start + rowsPerPage;
                const pageData = filteredLogs.slice(start, end);
                let html = '';
                pageData.forEach(log => {
                    let statusClass = 'badge-success';
                    if (log.status === 'failed' || log.status === 'danger') statusClass = 'badge-danger';
                    else if (log.status === 'info') statusClass = 'badge-info';
                    else if (log.action === 'DELETE') statusClass = 'badge-warning';
                    
                    html += `<tr>
                        <td>${log.ts}</td>
                        <td><div class="user-cell"><span class="avatar-icon">${log.avatar}</span> ${log.admin}</div></td>
                        <td><span class="badge ${statusClass}">${log.action}</span></td>
                        <td>${log.desc}</td>
                        <td>${log.ip}</td>
                        <td><span class="badge ${statusClass}">${log.status}</span></td>
                        <td>
                            <div class="action-buttons">
                                <button class="action-btn view" onclick='viewLogDetails(${JSON.stringify(log).replace(/'/g, "\\'")})'><i class="fas fa-eye"></i> View</button>
                            </div>
                        </td>
                    </tr>`;
                });
                tbody.innerHTML = html;
                renderPagination();
                tableEntryInfo.innerText = `showing ${pageData.length} of ${filteredLogs.length}`;
            }

            function renderPagination() {
                const totalPages = Math.ceil(filteredLogs.length / rowsPerPage);
                let pagHtml = '';
                pagHtml += `<div class="page-item" onclick="changePage(${currentPage-1})" ${currentPage === 1 ? 'style="pointer-events:none; opacity:0.5;"' : ''}><i class="fas fa-chevron-left"></i></div>`;
                for (let i = 1; i <= totalPages; i++) {
                    pagHtml += `<div class="page-item ${i === currentPage ? 'active' : ''}" onclick="changePage(${i})">${i}</div>`;
                }
                pagHtml += `<div class="page-item" onclick="changePage(${currentPage+1})" ${currentPage === totalPages ? 'style="pointer-events:none; opacity:0.5;"' : ''}><i class="fas fa-chevron-right"></i></div>`;
                paginationDiv.innerHTML = pagHtml;
            }

            window.changePage = function(page) {
                if (page < 1 || page > Math.ceil(filteredLogs.length / rowsPerPage)) return;
                currentPage = page;
                renderTable();
            };

            // update stats cards dynamically
            function updateStats() {
                const total = filteredLogs.length;
                const unique = [...new Set(filteredLogs.map(l => l.admin))].length;
                const week = filteredLogs.filter(l => l.ts.startsWith('2026-02-1')).length; // rough
                const security = filteredLogs.filter(l => l.action === 'SECURITY' || l.status === 'failed').length;
                statTotal.innerText = total;
                statUsers.innerText = unique;
                statWeek.innerText = week;
                statSecurity.innerText = security;
            }

            // search & filter
            function applyFilters() {
                const searchTerm = searchInput.value.toLowerCase();
                const actionType = document.getElementById('actionTypeFilter').value;
                const userFilter = document.getElementById('userFilter').value;
                const start = document.getElementById('startDate').value;
                const end = document.getElementById('endDate').value;

                filteredLogs = mockLogs.filter(log => {
                    let match = true;
                    if (searchTerm) {
                        match = match && (log.desc.toLowerCase().includes(searchTerm) || log.admin.toLowerCase().includes(searchTerm) || log.ip.includes(searchTerm));
                    }
                    if (actionType) {
                        match = match && log.action === actionType;
                    }
                    if (userFilter) {
                        const short = userFilter === 'bongani' ? 'Bongani' : (userFilter === 'thabo' ? 'Thabo' : 'Lerato');
                        match = match && log.admin.includes(short);
                    }
                    // date filtering (ignore if empty)
                    if (start && end) {
                        const logDate = log.ts.split(' ')[0];
                        match = match && (logDate >= start && logDate <= end);
                    }
                    return match;
                });
                currentPage = 1;
                renderTable();
                updateStats();
                showToast('Filters applied');
            }

            window.applyFilters = applyFilters;

            function resetFilters() {
                searchInput.value = '';
                document.getElementById('actionTypeFilter').value = '';
                document.getElementById('userFilter').value = '';
                document.getElementById('startDate').value = '';
                document.getElementById('endDate').value = '';
                filteredLogs = [...mockLogs];
                currentPage = 1;
                renderTable();
                updateStats();
                showToast('Filters reset');
            }
            window.resetFilters = resetFilters;

            // view details modal
            window.viewLogDetails = function(log) {
                document.getElementById('modalTitle').innerText = 'Audit Entry #' + log.id;
                const body = document.getElementById('modalBodyContent');
                body.innerHTML = `
                    <div style="display:grid; gap:14px;">
                        <p><strong>Timestamp:</strong> ${log.ts}</p>
                        <p><strong>Admin:</strong> ${log.admin}</p>
                        <p><strong>Action:</strong> <span class="badge badge-info">${log.action}</span></p>
                        <p><strong>Description:</strong> ${log.desc}</p>
                        <p><strong>IP address:</strong> ${log.ip}</p>
                        <p><strong>Status:</strong> <span class="badge ${log.status==='success'?'badge-success':'badge-danger'}">${log.status}</span></p>
                        <p><strong>User agent:</strong> Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36</p>
                        <p><strong>Session ID:</strong> sess_${Math.floor(Math.random()*10000)}</p>
                    </div>
                `;
                document.getElementById('modalActionBtn').style.display = 'none';
                document.getElementById('auditModal').classList.add('active');
            };

            window.closeModal = function() {
                document.getElementById('auditModal').classList.remove('active');
            };

            window.exportLogs = function() {
                showToast('Exporting audit logs (CSV) ... demo');
            };

            window.refreshLogs = function() {
                // random shuffle to simulate new entry
                showToast('Refreshed logs');
                renderTable();
            };

            // toggle filter bar
            filterToggleBtn.addEventListener('click', function() {
                if (filterBar.style.display === 'none' || filterBar.style.display === '') {
                    filterBar.style.display = 'block';
                } else {
                    filterBar.style.display = 'none';
                }
            });

            // live search (simple)
            searchInput.addEventListener('keyup', function(e) {
                if (e.key === 'Enter') applyFilters();
            });

            function showToast(msg) {
                const toast = document.getElementById('toast');
                toast.innerText = msg;
                toast.classList.add('show');
                setTimeout(() => toast.classList.remove('show'), 2500);
            }

            function attachEvents() {
                // any additional
            }

            // logout
            window.logout = function() {
                if (confirm('Logout from admin panel?')) {
                    window.location.href = 'login.html';
                }
            };

            // Add New (just demo)
            window.showAddModal = function() {
                alert('Add new audit log manually? Usually audit logs are auto-generated. Demo: you could add a note.');
            };

            // start
            init();
        })();
    </script>
    <!-- production ready modal and toast are functional -->
</body>
</html>